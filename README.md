# East Asian Ambiguous Widthã¨çµµæ–‡å­—ã®ç‚ºã®ä¿®æ­£ãƒ­ã‚±ãƒ¼ãƒ«

## East Asian Ambiguous Width å•é¡Œã¨ã¯

East Asian Ambiguous æ–‡å­—ã¨ã¯ã€Unicodeã§æ–‡å­—å¹…ãŒæ›–æ˜§ã¨å®šç¾©ã•ã‚Œã¦ã„ã‚‹æ–‡å­—ã®ã“ã¨ã§ã€ä¾‹ãˆã°ã€â—‹(U+25CB)ã‚„Ã—(U+00D7)ã‚„â–³(U+25B3)ãªã©ã®æ–‡å­—ã§ã™ã€‚

East Asian Ambiguous æ–‡å­—ã®ä¸€è¦§ã¯[ã“ã¡ã‚‰](https://raw.githubusercontent.com/hamano/locale-eaw/master/test.txt)ã€‚

East Asian Ambiguous Width å•é¡Œã¨ã¯ã€ã“ã‚Œã‚‰ã®æ–‡å­—ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§è¡¨ç¤ºã™ã‚‹éš›ã«ã€libcã®`wcwidth(3)`ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã€ã‚¨ãƒ‡ã‚£ã‚¿ãªã©ãŒãã‚Œãã‚Œç•°ãªã‚‹æ–‡å­—å¹…(åŠè§’ã€å…¨è§’)ã§æ–‡å­—ã‚’æ‰±ã†ãŸã‚ã€è¡¨ç¤ºãŒå£Šã‚Œã¦ã—ã¾ã†å•é¡Œã§ã™ã€‚

ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ã®å ´åˆã‚«ãƒ¼ã‚½ãƒ«ã®å†…éƒ¨çŠ¶æ…‹ã¨è¡¨ç¤ºä½ç½®ãŒã‚ºãƒ¬ãŸã‚Šã—ã¾ã™ã€‚

ã“ã®å•é¡Œã®ã¦ã£ã¨ã‚Šæ—©ã„è§£æ±ºæ–¹æ³•ã®ã²ã¨ã¤ã¯æ›–æ˜§ãªæ–‡å­—ã®æ–‡å­—å¹…ã‚’å…¨è§’ã§çµ±ä¸€ã™ã‚‹äº‹ã§ã™ã€‚

å¯¾å¿œæ–¹æ³•ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦æ§˜ã€…ã§ã™ãŒã€xterm, mlterm, vimãªã©ã‚’ä½¿ã£ã¦ã„ã‚‹äººã¯ç°¡å˜ã«è§£æ±ºã§ãã¾ã™ã€‚

ã—ã‹ã—ã€rxvt-unicodeã‚„emacsã‚’ä½¿ã£ã¦ã„ã‚‹äººã¯æ®‹å¿µã§ã—ãŸã€ã“ã‚Œã‚‰ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯æ›–æ˜§ãªæ–‡å­—å¹…ã‚’çµ±ä¸€ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

ã“ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã§ã¯ä¸»ã«rxvt-unicodeã¨emacså‘ã‘ã«æ›–æ˜§ãªæ–‡å­—å¹…å•é¡Œã‚’è§£æ±ºã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ¡ãƒ³ãƒ†ã—ã¦ã„ã¾ã™ã€‚

## çµµæ–‡å­—ã«ã¤ã„ã¦
çµµæ–‡å­—ã¯Narrowã¨å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã«ã‚‚é–¢ã‚ã‚‰ãšã€å¤šãã®ãƒ•ã‚©ãƒ³ãƒˆã§ã¯å…¨è§’ã§æã‹ã‚Œã¦ã„ã‚‹ã¨ã„ã†å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚
ãŸã¨ãˆã°ğŸ€€(U+1F000)ã€ğŸ•¿(U+1F57F)ã€‚
ã“ã®å•é¡Œã«å¯¾å‡¦ã™ã‚‹ãŸã‚ã€U+1F000-U+1FFFFã®ç¯„å›²ã®Narrowæ–‡å­—ã‚’å…¨è§’ã«ã™ã‚‹ã¨ã„ã†å¯¾å¿œã‚’è¡Œã„ã¾ã—ãŸã€‚
ã“ã®ç¯„å›²ä»¥å¤–ã®çµµæ–‡å­—ã«ã¤ã„ã¦ã¯ã‚ˆãåˆ†ã‹ã‚‰ãªã„ã®ã§ãã®ã¾ã¾ã«ã—ã¦ã‚ã‚Šã¾ã™ã€‚

## libcã®ãƒ­ã‚±ãƒ¼ãƒ«ã®æ›–æ˜§ãªæ–‡å­—å¹…ã‚’å…¨è§’ã«ã™ã‚‹

[ã“ã¡ã‚‰](http://vdr.jp/d/20070322.html)ã§é…å¸ƒã•ã‚Œã¦ã„ã‚‹ UTF-8-EAW-FULLWIDTH.gz ãŒã¡ã‚‡ã£ã¨å¤ããªã£ã¦ã„ãŸã®ã§åŒã˜æ–¹æ³•ã§ç”Ÿæˆã—ã¦ãƒ¡ãƒ³ãƒ†å‡ºæ¥ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

1. [UTF-8-EAW-FULLWIDTH.gz](https://raw.githubusercontent.com/hamano/locale-eaw/master/UTF-8-EAW-FULLWIDTH.gz) ã‚’ /usr/share/i18n/charmaps/ ã«é…ç½®

2. /etc/locale.gen ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´
~~~
#ja_JP.UTF-8 UTF-8
ja_JP.UTF-8 UTF-8-EAW-FULLWIDTH
~~~

3. locale-gen ã‚’å®Ÿè¡Œ

## rxvt-unicodeã§æ›–æ˜§ãªæ–‡å­—å¹…ã‚’å…¨è§’ã«ã™ã‚‹

libcã®ãƒ­ã‚±ãƒ¼ãƒ«ã‚’ä¿®æ­£ã™ã‚‹äº‹ã§ã€æ›–æ˜§ãªæ–‡å­—å¹…ã‚’çµ±ä¸€ã§ãã¾ã™ã€‚

## emacsã§æ›–æ˜§ãªæ–‡å­—å¹…ã‚’å…¨è§’ã«ã™ã‚‹

emacs21 ã¨ emacs22 ã¨ emacs23ä»¥é™ã§å¯¾å¿œæ–¹æ³•ãŒç•°ãªã‚Šã¾ã™ã€‚
æ§˜ã€…ãªemacsã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§å‹•ä½œã™ã‚‹elispã‚’ç”¨æ„ã—ã¦ã„ã¾ã™ã®ã§ã“ã‚Œã‚’ä½¿ã£ã¦ãã ã•ã„ã€‚

1. [eaw.el](https://raw.githubusercontent.com/hamano/locale-eaw/master/eaw.el) ã‚’ ~/.emacs.d/site-lisp/ ã«é…ç½®

2. .emacs ã«ä»¥ä¸‹ã‚’è¨­å®šã™ã‚‹

~~~
(add-to-list 'load-path "~/.emacs.d/site-lisp")
(require 'eaw)
(eaw-fullwidth)
~~~

## vimã§æ›–æ˜§ãªæ–‡å­—å¹…ã‚’å…¨è§’ã«ã™ã‚‹

.vimrc ã«ã€
~~~
if exists('&ambw')
    set ambw=double
endif
~~~
ã¨è¨­å®šã™ã‚‹ã€‚

## xtermã§æ›–æ˜§ãªæ–‡å­—å¹…ã‚’å…¨è§’ã«ã™ã‚‹

.Xresources ãªã©ã«ã€
~~~
xterm*utf8: 1
xterm*locale: true
xterm*cjkWidth: true
~~~
ã¨è¨­å®šã™ã‚‹ã€‚

## mltermã§æ›–æ˜§ãªæ–‡å­—å¹…ã‚’å…¨è§’ã«ã™ã‚‹

å®Ÿè¡Œã‚ªãƒ—ã‚·ãƒ§ãƒ³ã« `-a 2` ã‚’ä»˜ã‘ã‚‹ã‹ã€
.mlterm/main ã«ã€
~~~
col_size_of_width_a = 2
~~~
ã¨è¨­å®šã™ã‚‹ã€‚

çµµæ–‡å­—ã‚‚å…¨è§’ã«ã™ã‚‹ã«ã¯

~~~
unicode_full_width_areas = U+1F000-1FFFF
~~~

## GNU screenã§æ›–æ˜§ãªæ–‡å­—å¹…ã‚’å…¨è§’ã«ã™ã‚‹
~/.screenrc ã«
~~~
cjkwidth on
~~~
ã¨è¨­å®šã™ã‚‹ã€‚

## w3mã§æ›–æ˜§ãªæ–‡å­—å¹…ã‚’å…¨è§’ã«ã™ã‚‹

~/.w3m/config ã«
~~~
east_asian_width 1
~~~
ã¨è¨­å®šã™ã‚‹ã€‚

## tmux 2.2ä»¥é™

* libcã®ãƒ­ã‚±ãƒ¼ãƒ«ã‚’ä¿®æ­£ -> tmuxã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å†…ã®è¡¨ç¤ºã¯A=2ã«çµ±ä¸€ã§ãã¾ã™
* ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦åˆ†å‰²æ™‚ã®ç½«ç·šã¯æ”¹ä¿®ãŒå¿…è¦ã§ã™

## tmux 2.7ä»¥é™

libcã®ãƒ­ã‚±ãƒ¼ãƒ«ã‚’A=2ã«ä¿®æ­£ã—ãŸä¸Šã§ã€ä»¥ä¸‹ã®ä¿®æ­£ãŒå¿…è¦ã§ã—ãŸ

~~~
diff --git a/tmux.c b/tmux.c
index 5b73079..0377ddd 100644
--- a/tmux.c
+++ b/tmux.c
@@ -202,6 +202,7 @@ main(int argc, char **argv)
                        errx(1, "need UTF-8 locale (LC_CTYPE) but have %s", s);
        }

+       setlocale(LC_CTYPE, "");
        setlocale(LC_TIME, "");
        tzset();
~~~


ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãŒACSã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹å ´åˆã€ç½«ç·šã®æç”»ã«ACSã‚’ä½¿ã†ã‚ˆã†è¨­å®šã—ã¾ã™ã€‚

~/.tmux.conf:

~~~
set -ag terminal-overrides ',*:U8=0'
~~~

* [tmuxã®ç½«ç·šç´ ç‰‡ã‚’ACSã«å¼·åˆ¶ã™ã‚‹](https://qiita.com/yanma/items/2644e6db6f3bcf249690)
